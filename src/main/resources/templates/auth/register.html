<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>T·∫°o m·∫≠t kh·∫©u - DevCollab</title>
  <style>
    body {
      font-family: "Inter", Arial, sans-serif;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      width: 400px;
      text-align: center;
    }
    h2 { margin-bottom: 10px; }
    p { color: #666; margin-bottom: 25px; }
    input {
      width: 100%;
      padding: 12px;
      border-radius: 30px;
      border: 1px solid #ccc;
      margin-bottom: 14px;
      font-size: 15px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      border-radius: 30px;
      border: none;
      background: #000;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background: #222; }
    #msg {
      margin-top: 10px;
      font-size: 14px;
      color: #444;
      min-height: 20px;
    }
    a {
      text-decoration: none;
      color: #555;
      font-size: 13px;
      margin-top: 12px;
      display: inline-block;
    }
    a:hover { text-decoration: underline; }
  </style>
</head>

<body>
  <div class="container">
    <h2>T·∫°o m·∫≠t kh·∫©u</h2>
    <p>Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ t·∫°o t√†i kho·∫£n m·ªõi cho <strong id="userEmail"></strong></p>

    <input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
    <input type="password" id="confirmPassword" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required>

    <button id="registerBtn" onclick="registerUser()">ƒêƒÉng k√Ω</button>
    <p id="msg"></p>

    <a href="/view/signin">‚Üê Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
  </div>

  <script>
    const email = localStorage.getItem('email');
    document.getElementById('userEmail').textContent = email || '';

    async function registerUser() {
      const password = document.getElementById('password').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();
      const msg = document.getElementById('msg');
      const btn = document.getElementById('registerBtn');

      msg.textContent = '';
      msg.style.color = '#444';

      if (!email) {
        msg.textContent = 'Thi·∫øu email. Vui l√≤ng quay l·∫°i b∆∞·ªõc tr∆∞·ªõc.';
        msg.style.color = 'red';
        return;
      }
      if (!password || password.length < 6) {
        msg.textContent = 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.';
        msg.style.color = 'red';
        return;
      }
      if (password !== confirmPassword) {
        msg.textContent = 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.';
        msg.style.color = 'red';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'ƒêang t·∫°o t√†i kho·∫£n...';
      msg.textContent = 'ƒêang g·ª≠i m√£ OTP...';

      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        console.log('üì® Register OTP:', data);

        if (res.ok) {
          localStorage.setItem('verify_mode', 'register');
          msg.style.color = 'green';
          msg.textContent = 'ƒê√£ g·ª≠i m√£ OTP ƒë·∫øn email c·ªßa b·∫°n.';
          setTimeout(() => window.location.href = '/view/verify-otp', 800);
        } else {
          msg.style.color = 'red';
          msg.textContent = data.error || 'Kh√¥ng th·ªÉ g·ª≠i OTP.';
        }
      } catch (err) {
        console.error('L·ªói g·ª≠i OTP:', err);
        msg.style.color = 'red';
        msg.textContent = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi m√°y ch·ªß.';
      } finally {
        btn.disabled = false;
        btn.textContent = 'ƒêƒÉng k√Ω';
      }
    }
  </script>
</body>
</html>
