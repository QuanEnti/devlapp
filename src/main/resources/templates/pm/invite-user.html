<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invite User - AProjectO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body { display: flex; height: 100vh; background-color: #f6f7fb; color: #222; }

        /* Sidebar */
        .sidebar {
            width: 230px;
            background: #fff;
            box-shadow: 2px 0 6px rgba(0, 0, 0, 0.05);
            padding: 2rem 1rem;
        }
        .sidebar h2 { font-size: 18px; font-weight: 600; margin-bottom: 2rem; text-align: center; }
        .menu { list-style: none; }
        .menu li { padding: 12px 10px; margin-bottom: 6px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .menu li:hover { background: #f0f2f7; }

        /* Layout */
        .main { flex: 1; padding: 1.5rem 2rem; display: flex; flex-direction: column; }
        .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .search-box input { width: 300px; padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-info img { width: 36px; height: 36px; border-radius: 50%; }

        .content { display: flex; gap: 2rem; height: 100%; }

        .left, .right {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
        }

        /* Left panel */
        .left h3 { font-size: 20px; font-weight: 600; margin-bottom: 1.2rem; }

        select, input {
            width: 100%;
            margin: 8px 0 16px 0;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background-color: #111827;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
        }

        button:hover { background-color: #374151; }
        #invitedBtn { background-color: #9ca3af; cursor: default; }

        /* Project Card */
        .project-card {
            margin-top: 1rem;
            padding: 1.5rem;
            border-radius: 12px;
            background: #fff;
            border: 1px solid #f0f0f0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .project-card h4 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .project-card p { color: #444; margin-bottom: 6px; font-size: 14px; }

        .project-meta {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 10px; font-size: 13px; color: #ef4444; font-weight: 500;
        }

        .member-list { display: flex; align-items: center; gap: 10px; margin-top: 1rem; flex-wrap: wrap; }
        .member { display: flex; align-items: center; gap: 6px; background: #f9fafb;
            border-radius: 8px; padding: 6px 10px; }
        .member img { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; }

        #user-info {
            margin-top: 1.5rem;
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
        }

        /* Right profile section */
        .profile-container { display: flex; gap: 2rem; }

        .profile-info { flex: 0.9; text-align: center; }
        .profile-info img {
            width: 120px; height: 120px; border-radius: 50%;
            border: 3px solid #ec4899; margin-bottom: 1rem; object-fit: cover;
        }

        .profile-info h4 { font-size: 18px; font-weight: 600; }
        .profile-info p { color: #555; font-size: 14px; }

        .details { margin-top: 1.5rem; text-align: left; font-size: 14px; }
        .details p { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; color: #333; }
        .details span.icon { font-size: 16px; color: #6b7280; width: 18px; display: inline-block; }

        /* Related Projects */
        .related { flex: 1.2; }
        .related h5 { font-weight: 600; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .project-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .project-item { text-align: center; }
        .project-item img {
            width: 100%; height: 80px; border-radius: 8px; object-fit: cover;
            border: 2px solid #ec4899;
        }
        .project-item p {
            font-size: 13px;
            margin-top: 4px;
            color: #333;
        }
    </style>
</head>

<body>
<div class="sidebar">
    <h2>AProjectO</h2>
    <ul class="menu">
        <li>üè† Project</li>
        <li>üß© Tasks</li>
        <li>üïí Work Logs</li>
        <li>üìà Performance</li>
        <li>‚öôÔ∏è Settings</li>
    </ul>
</div>

<div class="main">
    <div class="topbar">
        <div class="search-box">
            <input type="text" placeholder="Search for anything...">
        </div>
        <div class="user-info">
            <span>Anima Agrawal</span>
            <img src="https://i.pravatar.cc/100?img=68" alt="user">
        </div>
    </div>

    <div class="content">
        <!-- LEFT: Project info + invite -->
        <div class="left">
            <h3>Invite User to Project</h3>
            <label>Choose Project</label>
            <select id="project" onchange="showProjectDetails()"></select>

            <div id="project-details"></div>

            <label>User Email</label>
            <input id="email" placeholder="Enter user email">

            <div style="display:flex; gap:10px;">
                <button onclick="findUser()">Find</button>
                <button id="invitedBtn">Invited</button>
            </div>

            <div id="user-info"></div>
        </div>

        <!-- RIGHT: Profile like Yash Ghori -->
        <div class="right">
            <div class="profile-container">
                <div class="profile-info" id="profile-info">
                    <img id="avatar" src="https://via.placeholder.com/120" alt="User">
                    <h4 id="name">User not found</h4>
                    <p id="location">---</p>

                    <div class="details" id="details">
                        <p><span class="icon">üíº</span> <span id="role">UI - Intern</span></p>
                        <p><span class="icon">üè¢</span> <span id="company">on-teak</span></p>
                        <p><span class="icon">üìû</span> <span id="phone">+91 7048144030</span></p>
                        <p><span class="icon">‚úâÔ∏è</span> <span id="emailDisplay">yghori@asite.com</span></p>
                        <p><span class="icon">üìÅ</span> <span id="projectCode">PDT - I</span></p>
                    </div>
                </div>

                <div class="related">
                    <h5>Related Projects</h5>
                    <div class="project-grid" id="related-projects">
                        <!-- Filled dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function loadProjects() {
        const res = await fetch('/api/pm/invite/projects');
        const data = await res.json();
        const select = document.getElementById('project');
        data.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.projectId;
            opt.textContent = p.name;
            select.appendChild(opt);
        });
    }

    async function showProjectDetails() {
        const projectId = document.getElementById('project').value;
        const res = await fetch(`/api/pm/invite/project/${projectId}`);
        const project = await res.json();

        const projectDiv = document.getElementById('project-details');
        projectDiv.innerHTML = `
      <div class="project-card">
        <h4>${project.name}</h4>
        <p>${project.description}</p>
        <div class="project-meta">
          <span>üìÖ ${project.startDate}</span>
          <span>‚û°Ô∏è ${project.endDate}</span>
        </div>
        <div class="member-list">
          ${project.members.map(m => `
            <div class="member">
              <img src="${m.avatarUrl || 'https://via.placeholder.com/32'}">
              <span>${m.name}</span>
            </div>`).join('')}
        </div>
      </div>
    `;
    }

    async function findUser() {
        const email = document.getElementById('email').value;
        const res = await fetch(`/api/pm/invite/find-user?email=${encodeURIComponent(email)}`);
        const user = await res.json();

        const avatar = document.getElementById('avatar');
        const name = document.getElementById('name');
        const location = document.getElementById('location');
        const role = document.getElementById('role');
        const company = document.getElementById('company');
        const emailDisplay = document.getElementById('emailDisplay');
        const info = document.getElementById('user-info');

        if (user && user.userId) {
            avatar.src = user.avatarUrl || "https://via.placeholder.com/120";
            name.textContent = user.name;
            location.textContent = user.timezone || "Unknown";
            role.textContent = user.status || "UI - Intern";
            company.textContent = user.skills || "on-teak";
            emailDisplay.textContent = user.email;

            info.innerHTML = `
        <p><strong>${user.name}</strong> (${user.email})</p>
        <button onclick="inviteUser(${user.userId})">Invite</button>
      `;

            // Load related projects dynamically
            loadRelatedProjects(user.userId);

        } else {
            avatar.src = "https://via.placeholder.com/120";
            name.textContent = "User not found";
            info.innerHTML = `<p>User not found</p>`;
            document.getElementById('related-projects').innerHTML = '';
        }
    }

    async function inviteUser(userId) {
        const projectId = document.getElementById('project').value;
        const formData = new URLSearchParams({ projectId, userId });
        const res = await fetch('/api/pm/invite/invite', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: formData
        });
        const msg = await res.json();
        alert(msg.message);
    }

    async function loadRelatedProjects(userId) {
        const res = await fetch(`/api/pm/invite/related-projects/${userId}`);
        const projects = await res.json();
        const grid = document.getElementById('related-projects');
        grid.innerHTML = '';

        projects.slice(0, 9).forEach(p => {
            const div = document.createElement('div');
            div.className = 'project-item';
            div.innerHTML = `
        <img src="${p.thumbnailUrl || `https://picsum.photos/200?random=${p.projectId}`}" alt="${p.name}">
        <p>${p.name}</p>
      `;
            grid.appendChild(div);
        });
    }

    window.onload = loadProjects;
</script>
</body>
</html>
